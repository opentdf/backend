apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "kas.name" . }}-cm
  labels:
    {{- include "kas.labels" . | nindent 4 }}
    app.kubernetes.io/part-of: kas
data:
  {{- with (coalesce .Values.endpoints.attrHost .Values.endpoints.easHost) }}
  ATTR_AUTHORITY_HOST: {{ tpl . $ | quote  }}
  {{- end }}
  FLASK_DEBUG: {{ .Values.flaskDebug | quote }}
  GUNICORN_WORKERS: {{ .Values.gunicornWorkers | default 1 | quote }}
  OIDC_SERVER_URL: {{ include "kas.oidcPubkeyEndpoint" . | quote }}
  LOGLEVEL: {{ .Values.logLevel | quote }}
  VERBOSE: {{ .Values.pdp.verbose | quote }}
  {{- with .Values.endpoints.statsdHost }}
  STATSD_HOST: {{ tpl . $ | quote  }}
  {{- end }}
  DISABLE_TRACING: {{ .Values.pdp.disableTracing | quote }}
  JSON_LOGGER: {{ .Values.jsonLogger | default "true" | quote }}
  AUDIT_ENABLED: {{ .Values.global.opentdf.common.auditLogEnabled | quote  }}
  SWAGGER_UI: {{ .Values.swaggerUIEnabled | quote }}
  USE_OIDC: "1"
  AUDIT_ORG_ID: {{ .Values.global.opentdf.common.auditOrgId | default "00000000-0000-0000-0000-000000000000" | quote }}
  {{- with .Values.endpoints.trustedEntitlers | join " " }}
  TRUSTED_ENTITLERS: {{ . }}
  {{- end }}
  PKCS11_SLOT_INDEX: {{ .Values.pkcs11.slotIndex | default 0 | quote }}
  PKCS11_TOKEN_LABEL: {{ .Values.pkcs11.tokenLabel | default "development-token" | quote }}
  {{- with .Values.pkcs11.modulePath | join " " }}
  PKCS11_MODULE_PATH: {{ tpl . $ | quote }}
  {{- end }}
  PKCS11_LABEL_PUBKEY_RSA: {{ .Values.pkcs11.pubRsaLabel | default "development-rsa-kas" | quote }}
  PKCS11_LABEL_PUBKEY_EC: {{ .Values.pkcs11.pubEcLabel | default "development-ec-kas" | quote }}
